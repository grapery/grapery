#!/bin/bash

# Grapery çŽ¯å¢ƒå˜é‡ç”Ÿæˆè„šæœ¬
# æ­¤è„šæœ¬ç”¨äºŽåœ¨CI/CDè¿‡ç¨‹ä¸­ç”Ÿæˆ.envæ–‡ä»¶

set -e

echo "ðŸ”§ å¼€å§‹ç”Ÿæˆ .env æ–‡ä»¶..."

# åˆ›å»º .env æ–‡ä»¶
cat > .env << EOF
# Grapery çŽ¯å¢ƒé…ç½®æ–‡ä»¶
# è‡ªåŠ¨ç”ŸæˆäºŽ $(date)

# æ•°æ®åº“é…ç½®
DB_HOST=${DB_ADDR:-mysql}
DB_PORT=3306
DB_USER=${DB_USER:-grapery}
DB_PASSWORD=${DB_PASSWORD}
DB_NAME=${DB_NAME:-grapery}

# Redisé…ç½®
REDIS_HOST=${REDIS_SERVER:-redis}
REDIS_PORT=6379
REDIS_PASSWORD=${REDIS_PASSWORD}

# åº”ç”¨é…ç½®
ENV=${DEPLOY_ENV:-production}
APP_PORT=8080
LLMCHAT_PORT=8070

# JWTé…ç½®
JWT_SECRET=${JWT_SECRET}
JWT_EXPIRE_HOURS=24

# æ”¯ä»˜é…ç½®
STRIPE_SECRET_KEY=${STRIPE_SECRET_KEY}
STRIPE_PUBLISHABLE_KEY=${STRIPE_PUBLISHABLE_KEY}
STRIPE_WEBHOOK_SECRET=${STRIPE_WEBHOOK_SECRET}

ALIPAY_APP_ID=${ALIPAY_APP_ID}
ALIPAY_PRIVATE_KEY=${ALIPAY_PRIVATE_KEY}
ALIPAY_PUBLIC_KEY=${ALIPAY_PUBLIC_KEY}
ALIPAY_NOTIFY_URL=${ALIPAY_NOTIFY_URL}
ALIPAY_RETURN_URL=${ALIPAY_RETURN_URL}

# é˜¿é‡Œäº‘é…ç½®
ALIYUN_ACCESS_KEY_ID=${ALIYUN_ACCESS_KEY_ID}
ALIYUN_ACCESS_KEY_SECRET=${ALIYUN_ACCESS_KEY_SECRET}
ALIYUN_REGION=${ALIYUN_REGION}
ALIYUN_OSS_BUCKET=${ALIYUN_OSS_BUCKET}
ALIYUN_OSS_ENDPOINT=${ALIYUN_OSS_ENDPOINT}
ALIYUN_ROLE_ARN=${ALIYUN_ROLE_ARN}
ALIYUN_API_KEY=${ALIYUN_API_KEY}
ALIYUN_SECRET_KEY=${ALIYUN_SECRET_KEY}

# Cozeé…ç½®
COZE_API_KEY=${COZE_API_KEY}
COZE_WORKSPACE_ID=${COZE_WORKSPACE_ID}

# æ™ºè°±AIé…ç½®
DASHSCOPE_API_KEY=${DASHSCOPE_API_KEY}
DOUBAO_API_KEY=${DOUBAO_API_KEY}

# é‚®ä»¶é…ç½®
SMTP_HOST=${SMTP_HOST}
SMTP_PORT=${SMTP_PORT}
SMTP_USERNAME=${SMTP_USERNAME}
SMTP_PASSWORD=${SMTP_PASSWORD}

# æ—¥å¿—é…ç½®
LOG_LEVEL=info
LOG_FILE=/var/log/grapery/app.log

# ç¼“å­˜é…ç½®
CACHE_TTL=3600

# å®‰å…¨é…ç½®
CORS_ALLOWED_ORIGINS=https://${DOMAIN_NAME}
RATE_LIMIT_REQUESTS=100
RATE_LIMIT_WINDOW=60

# ç›‘æŽ§é…ç½®
METRICS_ENABLED=true
METRICS_PORT=9090
EOF

echo "âœ… .env æ–‡ä»¶ç”Ÿæˆå®Œæˆï¼"
echo "ðŸ“‹ æ–‡ä»¶å†…å®¹é¢„è§ˆï¼š"
echo "=================="
head -20 .env
echo "..."
echo "==================" 
